import Card from"../scripts/components/Card.js";import{Api}from"../scripts/components/Api.js";import{initialCards,config,profileNameInput,profileSecondaryInput,buttonAdd,baseUrl,buttonAvatarEdit,currentUser,buttonEdit}from"../utils/constants.js";import{FormValidator}from"../scripts/components/FormValidator.js";import PopupWithForm from"../scripts/components/PopupWithForm.js";import PopupWithImage from"../scripts/components/PopupWithImage.js";import UserInfo from"../scripts/components/UserInfo.js";import Section from"../scripts/components/Section.js";import"../pages/index.css";var api=new Api({baseUrl,token:{authorization:"c4df37c2-ee37-468d-b548-ff18699e058a","Content-Type":"application/json"}}),popupWithAvatar=new PopupWithForm("#replace_avatar",avatarUpdateHandler);popupWithAvatar.setEventListeners();var popupWithImage=new PopupWithImage(".popup_open-card");popupWithImage.setEventListeners();var userInfo=new UserInfo(currentUser),addCardPopup=new PopupWithForm("#add_place",cardFormSubmitHandler);addCardPopup.setEventListeners(),buttonAdd.addEventListener("click",(function(){addCardPopup.openPopUp(),formValidators["place-add"].resetValidation()}));var deleteCardPopup=new PopupWithForm("#confirm-delete",cardFormSubmitHandler);deleteCardPopup.setEventListeners();export var profileCardPopup=new PopupWithForm("#profile__popup",updateProfileCard);profileCardPopup.setEventListeners(),buttonEdit.addEventListener("click",(function(){pressedEditButton(userInfo.getUserInfo()),profileCardPopup.openPopUp(),formValidators["profile-edit"].resetValidation()}));var userID=api.getUserInfo().then((function(e){return e._id}));console.dir(userID);var createCard=function(e){var r=new Card(e,"#elements-template",popupWithImage.open,(function(e){deleteCardPopup.openPopUp(),deleteCardPopup.customSubmit((function(){api.deleteCard(e).then((function(){r.deleteCard(),deleteCardPopup.processLoading(),setTimeout(deleteCardPopup.processLoading,1500),deleteCardPopup.closePopUp()}))}))}),(function(e){r._isLiked()?api.removeLike(e):api.addLike(e)}),userID);return r.createCard()},renderCard=function(e){cardsContainer.prependItem(createCard(e.name,e.link))},cardsContainer=new Section({data:initialCards,renderer:renderCard},".elements");cardsContainer.renderItems();var formValidators={};function cardFormSubmitHandler(e){addCardPopup.processLoading(),setTimeout(addCardPopup.processLoading,1500),api.createCard(e).then((function(e){var r=createCard(e);cardsContainer.prependItem(r),addCardPopup.closePopUp()}))}function avatarUpdateHandler(e){api.setUserAvatar(e.link).then((function(e){userInfo.setUserAvatar(e)}))}function updateProfileCard(e){api.setUserInfo(e.profileFormName,e.profileFormSecondary).then((function(e){userInfo.setUserInfo(e.name,e.about),profileCardPopup.processLoading(),setTimeout(profileCardPopup.processLoading,1500),profileCardPopup.closePopUp()})).catch((function(e){return console.log(e)}))}function pressedEditButton(e){var r=e.name,o=e.about;profileNameInput.value=r,profileSecondaryInput.value=o,profileCardPopup.openPopUp()}Array.from(document.forms).forEach((function(e){formValidators[e.id]=new FormValidator(config,e),formValidators[e.id].enableValidation()})),api.getUserInfo().then((function(e){userInfo.setUserInfo(e),userInfo.setUserAvatar(e.avatar)})).catch((function(e){return console.log(e)})),api.getInitialCards().then((function(e){e.forEach((function(e){cardsContainer.prependItem(createCard(e))}))})).catch((function(e){return console.log(e)})),buttonAvatarEdit.addEventListener("click",(function(){popupWithAvatar.openPopUp()}));